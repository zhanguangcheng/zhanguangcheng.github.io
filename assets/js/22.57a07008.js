(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{439:function(t,a,s){"use strict";s.r(a);var e=s(2),n=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"安装部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装部署"}},[t._v("#")]),t._v(" 安装部署")]),t._v(" "),a("p",[t._v("部署步骤：")]),t._v(" "),a("ol",[a("li",[t._v("安装OpenResty")]),t._v(" "),a("li",[t._v("下载waf的lua脚本")]),t._v(" "),a("li",[t._v("OpenResty中引入lua脚本")]),t._v(" "),a("li",[t._v("配置waf规则：/usr/local/openresty/nginx/conf/waf/rule-config")])]),t._v(" "),a("h3",{attrs:{id:"openresty安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#openresty安装"}},[t._v("#")]),t._v(" OpenResty安装")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://openresty.org/en/",target:"_blank",rel:"noopener noreferrer"}},[t._v("OpenResty"),a("OutboundLink")],1),t._v(" 是一个基于 "),a("a",{attrs:{href:"https://openresty.org/cn/nginx.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Nginx"),a("OutboundLink")],1),t._v(" 与 Lua 的高性能 Web 平台，其内部集成了大量精良的 Lua 库、第三方模块以及大多数的依赖项。用于方便地搭建能够处理超高并发、扩展性极高的动态 Web 应用、Web 服务和动态网关。")]),t._v(" "),a("p",[t._v("来源：https://openresty.org/cn/linux-packages.html")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" https://openresty.org/package/centos/openresty.repo\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mv")]),t._v(" openresty.repo /etc/yum.repos.d/\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" openresty\n")])])]),a("h3",{attrs:{id:"waf部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#waf部署"}},[t._v("#")]),t._v(" WAF部署")]),t._v(" "),a("p",[t._v("下载waf脚本")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" https://github.com/zhanguangcheng/nginx-lua-waf/archive/refs/heads/master.zip\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("unzip")]),t._v(" master.zip\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-r")]),t._v(" ./nginx-lua-waf-master/waf /usr/local/openresty/nginx/conf/\n")])])]),a("p",[t._v("在OpenResty配置文件中引入脚本")]),t._v(" "),a("p",[t._v("vim /usr/local/openresty/nginx/conf/nginx.conf")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("lua_shared_dict")]),t._v(" limit "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50m")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("lua_package_path")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/local/openresty/nginx/conf/waf/?.lua;;"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("init_by_lua_file")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/local/openresty/nginx/conf/waf/init.lua"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("access_by_lua_file")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/local/openresty/nginx/conf/waf/access.lua"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("header_filter_by_lua_file")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/local/openresty/nginx/conf/waf/header_filter.lua"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token directive"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("启动")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ln")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" /usr/local/openresty/lualib/resty/ /usr/local/openresty/nginx/conf/waf/resty\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 检查配置语法")]),t._v("\nopenresty "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v("\n\nsystemctl start openresty\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" openresty\n")])])]),a("h2",{attrs:{id:"测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[t._v("#")]),t._v(" 测试")]),t._v(" "),a("ul",[a("li",[t._v("访问非法路径，使用浏览器访问：http://192.168.1.217/.svn/entries")]),t._v(" "),a("li",[t._v("在url参数、POST参数、Cookie中包含非法字符串时")]),t._v(" "),a("li",[t._v("上传木马文件，如xxx.php")]),t._v(" "),a("li",[t._v("访问频率过快")]),t._v(" "),a("li",[t._v("...")])]),t._v(" "),a("p",[t._v("都将会触发防火墙，或者直接返回403无权限访问")]),t._v(" "),a("p",[a("img",{attrs:{src:"/images/e98e427428b3484e80ba44f541bbf2e0.png",alt:"e98e427428b3484e80ba44f541bbf2e0.png"}})]),t._v(" "),a("h2",{attrs:{id:"更多"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更多"}},[t._v("#")]),t._v(" 更多")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/zhanguangcheng/nginx-lua-waf",target:"_blank",rel:"noopener noreferrer"}},[t._v("zhanguangcheng/nginx-lua-waf"),a("OutboundLink")],1)]),t._v(" "),a("blockquote",[a("p",[t._v("🕑 最后更新时间: 2022-09-24 23:24")])])])}),[],!1,null,null,null);a.default=n.exports}}]);