(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{433:function(a,s,t){"use strict";t.r(s);var r=t(2),e=Object(r.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("p",[a._v("mysqldumpæ˜¯MySQLå®˜ç½‘çš„ä¸€ä¸ªé€»è¾‘å¤‡ä»½å·¥å…·ï¼Œé€‚ç”¨äºŽæ•°æ®é‡ä¸å¤§çš„å¤‡ä»½åœºæ™¯ï¼Œå¤§é‡æ•°æ®å¤‡ä»½æŽ¨èç‰©ç†å¤‡ä»½å·¥å…·xtrabackup")]),a._v(" "),s("ul",[s("li",[s("RouterLink",{attrs:{to:"/posts/2022/MySQLæ•°æ®åº“å¤‡ä»½ä¹‹xtrabackup.html"}},[a._v("MySQLæ•°æ®åº“å¤‡ä»½ä¹‹xtrabackup")])],1)]),a._v(" "),s("h2",{attrs:{id:"æ•°æ®åº“å¤‡ä»½"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ•°æ®åº“å¤‡ä»½"}},[a._v("#")]),a._v(" æ•°æ®åº“å¤‡ä»½")]),a._v(" "),s("p",[a._v("æç¤ºï¼šå¯ä»¥ç»“åˆrsyncå°†å¤‡ä»½æ–‡ä»¶å¤åˆ¶åˆ°è¿œç¨‹æœåŠ¡å™¨ä¸Šå®žçŽ°ç¾å¤‡ï¼Œå†ä½¿ç”¨mysqlbinlogå·¥å…·åŒæ­¥binlogåˆ°è¿œç¨‹æœåŠ¡å™¨ä¸Šä»¥å¤‡ä»½å¢žé‡æ•°æ®")]),a._v(" "),s("ul",[s("li",[s("RouterLink",{attrs:{to:"/posts/2022/inotifywaitï¼‹rsyncå®žçŽ°è¿œç¨‹æ–‡ä»¶å®žæ—¶åŒæ­¥.html"}},[a._v("inotifywaitï¼‹rsyncå®žçŽ°è¿œç¨‹æ–‡ä»¶å®žæ—¶åŒæ­¥")])],1),a._v(" "),s("li",[s("RouterLink",{attrs:{to:"/posts/2022/MySQLæ•°æ®åº“binlogè¿œç¨‹å®žæ—¶å¤‡ä»½.html"}},[a._v("MySQLæ•°æ®åº“binlogè¿œç¨‹å®žæ—¶å¤‡ä»½")])],1)]),a._v(" "),s("h3",{attrs:{id:"æ‰‹åŠ¨å¤‡ä»½"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ‰‹åŠ¨å¤‡ä»½"}},[a._v("#")]),a._v(" æ‰‹åŠ¨å¤‡ä»½")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mysqldump "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-h127.0.0.1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-uroot")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-proot")]),a._v(" åº“å --master-data"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" --ignore-table"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("åº“å.ä¸å¤‡ä»½çš„è¡¨å1 --ignore-table"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("åº“å.ä¸å¤‡ä»½çš„è¡¨å2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">")]),a._v("/dev/null "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("gzip")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" backup.sql.gz\n")])])]),s("h3",{attrs:{id:"è‡ªåŠ¨å¤‡ä»½"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è‡ªåŠ¨å¤‡ä»½"}},[a._v("#")]),a._v(" è‡ªåŠ¨å¤‡ä»½")]),a._v(" "),s("p",[a._v("å…¨åº“å¤‡ä»½å¹¶åŽ‹ç¼©ä¸ºgzï¼Œä¿ç•™æœ€è¿‘30å¤©")]),a._v(" "),s("p",[a._v("vim /usr/local/scripts/mysql_backup.sh")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token shebang important"}},[a._v("#!/bin/bash")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("BACKUP_DIR")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/data/backups\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("NAME")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("database_backup_\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("TIME")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("date")]),a._v(" +%Y%m%d%H%M%S"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$BACKUP_DIR")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("then")]),a._v("\n\t"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" /data/backups\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("fi")]),a._v("\n\nmysqldump "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-h127.0.0.1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-uroot")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-proot")]),a._v(" åº“å --master-data"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" --ignore-table"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("åº“å.ä¸å¤‡ä»½çš„è¡¨å1 --ignore-table"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("åº“å.ä¸å¤‡ä»½çš„è¡¨å2 "),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">")]),a._v("/dev/null "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("gzip")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$BACKUP_DIR")]),a._v("/"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$NAME")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$TIME")]),a._v(".sql.gz\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("find")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$BACKUP_DIR")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-name")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"'),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$NAME")]),a._v('*.sql.gz"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-type")]),a._v(" f "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-mtime")]),a._v(" +30 "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-exec")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /dev/null "),s("span",{pre:!0,attrs:{class:"token operator"}},[s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("2")]),a._v(">")]),s("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[a._v("&1")]),a._v("\n")])])]),s("p",[a._v("æ¯å¤©å®šæ—¶æ‰§è¡Œ")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("echo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'0 0 * * * root /usr/local/scripts/mysql_backup.sh'")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v(" /etc/crontab\n")])])]),s("h2",{attrs:{id:"æ•°æ®åº“æ¢å¤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ•°æ®åº“æ¢å¤"}},[a._v("#")]),a._v(" æ•°æ®åº“æ¢å¤")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("zcat backup.sql.gz "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" mysql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-h127.0.0.1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-uroot")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-proot")]),a._v(" åº“å\n")])])]),s("h2",{attrs:{id:"mysql-binlogåŸºäºŽæ—¶é—´ç‚¹æ¢å¤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mysql-binlogåŸºäºŽæ—¶é—´ç‚¹æ¢å¤"}},[a._v("#")]),a._v(" MySQL binlogåŸºäºŽæ—¶é—´ç‚¹æ¢å¤")]),a._v(" "),s("p",[a._v("mysqldumpå¤‡ä»½æ•°æ®æ—¶è®°å½•MySQLçš„binlogæ—¥å¿—çš„æ–‡ä»¶åç§°å’Œpositionï¼ˆéœ€å¼€å¯MySQLçš„binlogï¼‰")]),a._v(" "),s("p",[a._v("å¼€å¯binlog\nvim /etc/my.cnf")]),a._v(" "),s("div",{staticClass:"language-ini extra-class"},[s("pre",{pre:!0,attrs:{class:"language-ini"}},[s("code",[s("span",{pre:!0,attrs:{class:"token section"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token section-name selector"}},[a._v("mysqld")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("log_bin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("mysql-bin")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("server-id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("1")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[a._v("expire_logs_days")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[a._v("30")]),a._v("\n")])])]),s("p",[a._v("å¤‡ä»½æ—¶æ–°å¢žå‚æ•°"),s("code",[a._v("--master-data=2")]),a._v("ä»¥æ³¨é‡Šçš„æ–¹å¼è®°å½•binlogæ–‡ä»¶åç§°å’Œposition")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("mysqldump -uroot -proot test --master-data=2 > backup.sql\n")])])]),s("p",[a._v("head -n 30 backup.sql")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("...\n--\n-- Position to start replication or point-in-time recovery from\n--\n\n-- CHANGE MASTER TO MASTER_LOG_FILE='mysql-bin.000004', MASTER_LOG_POS=419;\n...\n")])])]),s("p",[a._v("æ ¹æ®binlogåŸºäºŽæ—¶é—´ç‚¹æ¢å¤æ•°æ®\næ³¨æ„äº‹é¡¹ï¼šæ¢å¤å‰å…³é—­binlogæ—¥å¿—")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("mysql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-uroot")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-proot")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'set sql_log_bin=0'")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("MASTER_LOG_POS")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("head")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("30")]),a._v(" backup.sql"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"CHANGE MASTER TO"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("awk")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'END{a=substr($6,index($6,\"=\")+1);a=substr(a,1,length(a)-1);print a}'")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("MASTER_LOG_FILE")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("head")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("30")]),a._v(" backup.sql"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"CHANGE MASTER TO"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("awk")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'END{a=substr($5,index($5,\"=\")+2);a=substr(a,1,length(a)-2);print a}'")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("\nmysqlbinlog --start-position"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$MASTER_LOG_POS")]),a._v(" --stop-datetime"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"2022-07-05 14:13:00"')]),a._v(" /var/lib/mysql/"),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$MASTER_LOG_FILE")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" data.sql\nmysql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-uroot")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-proot")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" data.sql\nmysql "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-uroot")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-proot")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'set sql_log_bin=1'")]),a._v("\n")])])]),s("p",[a._v("mysqlbinlogå‚æ•°è¯´æ˜Žï¼š")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('--base64-output=decode-rows -v         è§£ç ä¸ºå¯è¯»çš„æ–‡æœ¬ï¼Œä½†ä¸èƒ½ç”¨äºŽæ¢å¤\n--start-position=875                   èµ·å§‹posç‚¹\n--stop-position=954                    ç»“æŸposç‚¹\n--start-datetime="2016-9-25 22:01:08"  èµ·å§‹æ—¶é—´ç‚¹\n--stop-datetime="2019-9-25 22:09:46"   ç»“æŸæ—¶é—´ç‚¹\n--database=test                        æŒ‡å®šåªæ¢å¤testæ•°æ®åº“\n')])])]),s("blockquote",[s("p",[a._v("ðŸ•‘ æœ€åŽæ›´æ–°æ—¶é—´: 2022-10-16 14:57")])])])}),[],!1,null,null,null);s.default=e.exports}}]);