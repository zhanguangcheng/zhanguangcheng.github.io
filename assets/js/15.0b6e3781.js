(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{432:function(s,a,t){"use strict";t.r(a);var r=t(2),e=Object(r.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("MySQLçš„binlogæ—¥å¿—æ˜¯å®žçŽ°å®žæ—¶å¤‡ä»½çš„å…³é”®ï¼Œä½†æ˜¯æœ¬åœ°å¤‡ä»½ä¸èƒ½è§£å†³ç¾å¤‡é—®é¢˜ï¼Œå°†binlogè¿œç¨‹å®žæ—¶å¤‡ä»½ä»¥å®žçŽ°ç¾å¤‡æœºåˆ¶ï¼Œé˜²æ­¢ç¡¬ç›˜æŸåã€åˆ åº“ç­‰é£Žé™©")]),s._v(" "),a("p",[s._v("å‚è€ƒï¼š"),a("a",{attrs:{href:"https://blog.csdn.net/a12345678n/article/details/105066462",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://blog.csdn.net/a12345678n/article/details/105066462"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("åŽŸç†ï¼šä½¿ç”¨mysqlbinlogå·¥å…·åœ¨å¤‡ä»½æœåŠ¡å™¨ä¸Šæ‹‰å–binlogæ–‡ä»¶")]),s._v(" "),a("p",[s._v("mysqlbinlogå‚æ•°:")]),s._v(" "),a("ul",[a("li",[s._v("--read-from-remote-server ä»Žè¿œç¨‹æœåŠ¡å™¨è¯»å–")]),s._v(" "),a("li",[s._v("--stop-never ä¸€ç›´è¯»å–")])]),s._v(" "),a("h2",{attrs:{id:"ç¤ºä¾‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç¤ºä¾‹"}},[s._v("#")]),s._v(" ç¤ºä¾‹")]),s._v(" "),a("p",[s._v("éœ€æŒ‡å®šä¸€ä¸ªbinlogåç§°ï¼Œä¼šä»ŽæŒ‡å®šçš„åç§°å¼€å§‹å¾€åŽåŒæ­¥åˆ°æœ€åŽä¸€ä¸ªbinlogæ–‡ä»¶\nå½“æœåŠ¡å™¨åˆ·æ–°binlogæ—¶ä¼šè‡ªåŠ¨åŒæ­¥æœ€æ–°çš„binlogæ–‡ä»¶")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("mysqlbinlog "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--raw")]),s._v(" --read-from-remote-server --stop-never "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.216 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("grass "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("grass mysql-bin.000001\n")])])]),a("h2",{attrs:{id:"åŒæ­¥binlogæ—¥å¿—è„šæœ¬"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#åŒæ­¥binlogæ—¥å¿—è„šæœ¬"}},[s._v("#")]),s._v(" åŒæ­¥binlogæ—¥å¿—è„šæœ¬ï¼š")]),s._v(" "),a("ul",[a("li",[s._v("ä»Žå·²åŒæ­¥çš„æœ€æ–°çš„binlogæ–‡ä»¶åç§°å¼€å§‹åŒæ­¥ï¼Œä¸å­˜åœ¨å°±ä»Žç¬¬ä¸€ä¸ªå¼€å§‹åŒæ­¥")]),s._v(" "),a("li",[s._v("å½“MySQLæœåŠ¡å™¨æš‚æ—¶ä¸å¯èƒ½æ—¶ï¼Œåœæ­¢åŒæ­¥ï¼Œæ¢å¤æ—¶ç»§ç»­åŒæ­¥")])]),s._v(" "),a("p",[s._v("vim /usr/local/scripts/mysqlbinlog-sync.sh")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/sh")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BACKUP_BIN")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/bin/mysqlbinlog"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BACKUP_DIR")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/data/mysql/binlog/"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LOGFILE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/log/mysqlbinlog-sync.log"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("REMOTE_HOST")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.1.216"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("REMOTE_PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3306"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("REMOTE_USER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"grass"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("REMOTE_PASS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"grass"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SLEEP_SECONDS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQLCOMMAND")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mysql -h'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$REMOTE_HOST")]),s._v(" -u"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$REMOTE_USER")]),s._v(" -p"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$REMOTE_PASS")]),s._v(" -P"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$REMOTE_PORT")]),s._v(' --protocol=tcp -N -e "')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FIRST_BINLOG")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("$MYSQLCOMMAND "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"show binary logs"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("/dev/null"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("head")]),s._v(" -1"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $1}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$FIRST_BINLOG")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"æ— æ³•èŽ·å–binlogä¿¡æ¯ï¼Œè¯·æ£€æŸ¥æ•°æ®åº“å¸å·æƒé™å’Œå½“å‰æ•°æ®åº“æ˜¯å¦æ‰“å¼€binlogæ—¥å¿—"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("save_log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"['),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" +"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%Y-%m-%d %H:%M:%S'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("] "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$LOGFILE")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BACKUP_DIR")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BACKUP_DIR")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-A")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BACKUP_DIR}")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-eq")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n     "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LAST_FILE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${FIRST_BINLOG}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n     "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LAST_FILE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("BACKUP_DIR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("head")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n  save_log "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"start backup mysqlbinlog:'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$LAST_FILE")]),s._v('"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$BACKUP_BIN")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--raw")]),s._v(" --read-from-remote-server --stop-never "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${REMOTE_HOST}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${REMOTE_PORT}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${REMOTE_USER}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${REMOTE_PASS}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${LAST_FILE}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("/dev/null\n  save_log "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mysqlbinlog stop:'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v('"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SLEEP_SECONDS")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n")])])]),a("p",[s._v("è®¾ç½®è„šæœ¬è‡ªåŠ¨åœ¨åŽå°è¿è¡Œï¼Œå¹¶è®¾ç½®å¼€æœºå¯åŠ¨")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /usr/lib/systemd/system/mysqlbinlog-sync.service "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n[Unit]\nDescription=mysqlbinlog-sync\nAfter=network.target\n\n[Service]\nUser=root\nGroup=root\nExecStart=/bin/bash /usr/local/scripts/mysqlbinlog-sync.sh\nExecStop=\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\nEOF")]),s._v("\n\nsystemctl daemon-reload\nsystemctl start mysqlbinlog-sync\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" mysqlbinlog-sync\n")])])]),a("blockquote",[a("p",[s._v("ðŸ•‘ æœ€åŽæ›´æ–°æ—¶é—´: 2022-10-15 13:42")])])])}),[],!1,null,null,null);a.default=e.exports}}]);