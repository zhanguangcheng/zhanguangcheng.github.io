(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{438:function(a,s,t){"use strict";t.r(s);var e=t(2),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("p",[a._v("inotifyæ˜¯æ–‡ä»¶ç›‘æŽ§å·¥å…·ï¼Œå¯ä»¥ç›‘æŽ§åˆ°æ–‡ä»¶çš„å˜æ›´ï¼Œå¦‚åˆ›å»ºã€åˆ é™¤ã€ç§»åŠ¨ã€å±žæ€§ä¿®æ”¹ã€è®¿é—®ç­‰ç­‰ï¼Œå¯ä»¥ç»“åˆæ–‡ä»¶è¿œç¨‹åŒæ­¥å·¥å…·rsyncå®žçŽ°æ–‡ä»¶å˜æ›´å®žæ—¶åŒæ­¥ã€‚")]),a._v(" "),s("h2",{attrs:{id:"æ¦‚è¿°"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¦‚è¿°"}},[a._v("#")]),a._v(" æ¦‚è¿°")]),a._v(" "),s("p",[a._v("inotifyæ˜¯æ–‡ä»¶ç›‘æŽ§å·¥å…·ï¼Œå¯ä»¥ç›‘æŽ§åˆ°æ–‡ä»¶çš„å˜æ›´ï¼Œå¦‚åˆ›å»ºã€åˆ é™¤ã€ç§»åŠ¨ã€å±žæ€§ä¿®æ”¹ã€è®¿é—®ç­‰ç­‰ï¼Œå¯ä»¥ç»“åˆæ–‡ä»¶è¿œç¨‹åŒæ­¥å·¥å…·rsyncå®žçŽ°æ–‡ä»¶å˜æ›´å®žæ—¶åŒæ­¥ã€‚")]),a._v(" "),s("p",[a._v("æç¤ºï¼šéœ€è¦å†…æ ¸2.6.13ä»¥åŽå†…æ ¸ç‰ˆæœ¬æ‰èƒ½æ”¯æŒinotify\nå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½åæŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("uname")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v("\n")])])]),s("h2",{attrs:{id:"å®‰è£…"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å®‰è£…"}},[a._v("#")]),a._v(" å®‰è£…")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("yum "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" inotify-tools\n")])])]),s("h2",{attrs:{id:"inotifywaitçš„ä½¿ç”¨"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#inotifywaitçš„ä½¿ç”¨"}},[a._v("#")]),a._v(" inotifywaitçš„ä½¿ç”¨")]),a._v(" "),s("p",[a._v("å‚æ•°è¯´æ˜Žï¼š")]),a._v(" "),s("ul",[s("li",[a._v("--exclude pattern æŽ’é™¤æ–‡ä»¶")]),a._v(" "),s("li",[a._v("--excludei pattern æŽ’é™¤æ–‡ä»¶ï¼Œä¸åŒºåˆ†å¤§å°å†™")]),a._v(" "),s("li",[a._v("-r --recursive é€’å½’ç›®å½•")]),a._v(" "),s("li",[a._v("-m --monitor ä¿æŒä¸€ç›´ç›‘å¬ï¼Œè€Œä¸æ˜¯ç›‘å¬åˆ°æœ‰å˜åŠ¨çš„æ–‡ä»¶å°±é€€å‡ºäº†")]),a._v(" "),s("li",[a._v("-e --event è¦ç›‘å¬çš„äº‹ä»¶ï¼Œå¤šä¸ªç”¨(,)å·éš”å¼€ï¼Œé»˜è®¤å…¨éƒ¨\n"),s("ul",[s("li",[a._v("create")]),a._v(" "),s("li",[a._v("delete")]),a._v(" "),s("li",[a._v("modify")]),a._v(" "),s("li",[a._v("attrib")]),a._v(" "),s("li",[a._v("open")]),a._v(" "),s("li",[a._v("close")]),a._v(" "),s("li",[a._v("access")]),a._v(" "),s("li",[a._v("unmount")])])]),a._v(" "),s("li",[a._v("-q --quiet ç»“æžœç²¾ç®€")]),a._v(" "),s("li",[a._v("--format fmt ç»“æžœæ ¼å¼åŒ–\n"),s("ul",[s("li",[a._v("%w è¡¨ç¤ºå‘ç”Ÿäº‹ä»¶çš„ç›®å½•")]),a._v(" "),s("li",[a._v("%f è¡¨ç¤ºå‘ç”Ÿäº‹ä»¶çš„æ–‡ä»¶")]),a._v(" "),s("li",[a._v("%e è¡¨ç¤ºå‘ç”Ÿçš„äº‹ä»¶")]),a._v(" "),s("li",[a._v("%Xe äº‹ä»¶ä»¥â€œXâ€åˆ†éš”")]),a._v(" "),s("li",[a._v("%T ä½¿ç”¨ç”±â€“timefmtå®šä¹‰çš„æ—¶é—´æ ¼å¼")])])]),a._v(" "),s("li",[a._v("--timefmt fmt æ—¶é—´æ ¼å¼åŒ–")])]),a._v(" "),s("p",[a._v("å®žæ—¶ç›‘æŽ§æ–‡ä»¶å˜åŒ–")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("inotifywait "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rmq")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"create,modify,delete,move,attrib"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--exclude")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"\\.(swp|swx)$"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--format")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"%w%f"')]),a._v(" /var/www/xxx\n")])])]),s("h2",{attrs:{id:"ç»“åˆrsyncå®žæ—¶è¿œç¨‹åŒæ­¥è„šæœ¬"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç»“åˆrsyncå®žæ—¶è¿œç¨‹åŒæ­¥è„šæœ¬"}},[a._v("#")]),a._v(" ç»“åˆrsyncå®žæ—¶è¿œç¨‹åŒæ­¥è„šæœ¬")]),a._v(" "),s("p",[a._v("æ³¨æ„ï¼šè¿œç¨‹åŒæ­¥éœ€è¦ç”Ÿæˆrsaå…¬é’¥å’Œç§é’¥è¿›è¡Œè®¤è¯ï¼Œé¿å…è¾“å…¥å¯†ç ã€‚")]),a._v(" "),s("p",[a._v("vim /usr/local/scripts/file-sync.sh")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token shebang important"}},[a._v("#!/bin/bash")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("PATH_SRC")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/data/xxx/\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("PATH_DEST")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("root@192.168.1.217:/data/backups/xxx/\n\n/usr/bin/inotifywait "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-mrq")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"create,modify,attrib,move,delete"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--format")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"%f"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--exclude")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"\\.(swp|swx)$"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$PATH_SRC")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("while")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("read")]),a._v(" line\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("do")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#echo $line")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$line")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("then")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rsync")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-az")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$PATH_SRC")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$line")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$PATH_DEST")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$line")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rsync")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-az")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--delete")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$PATH_SRC")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$PATH_DEST")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("fi")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("done")]),a._v("\n")])])]),s("p",[a._v("è®¾ç½®è„šæœ¬è‡ªåŠ¨åœ¨åŽå°è¿è¡Œï¼Œå¹¶è®¾ç½®å¼€æœºå¯åŠ¨")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /usr/lib/systemd/system/file-sync.service "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("EOF\n[Unit]\nDescription=file-sync\nAfter=network.target\n\n[Service]\nUser=root\nGroup=root\nExecStart=/bin/bash /usr/local/scripts/file-sync.sh\nExecStop=\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\nEOF")]),a._v("\n\nsystemctl daemon-reload\nsystemctl start file-sync\nsystemctl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("enable")]),a._v(" file-sync\n")])])]),s("blockquote",[s("p",[a._v("ðŸ•‘ æœ€åŽæ›´æ–°æ—¶é—´: 2022-10-14 08:32")])])])}),[],!1,null,null,null);s.default=r.exports}}]);