(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{438:function(a,s,t){"use strict";t.r(s);var e=t(2),r=Object(e.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("p",[a._v("inotify是文件监控工具，可以监控到文件的变更，如创建、删除、移动、属性修改、访问等等，可以结合文件远程同步工具rsync实现文件变更实时同步。")]),a._v(" "),s("h2",{attrs:{id:"概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[a._v("#")]),a._v(" 概述")]),a._v(" "),s("p",[a._v("inotify是文件监控工具，可以监控到文件的变更，如创建、删除、移动、属性修改、访问等等，可以结合文件远程同步工具rsync实现文件变更实时同步。")]),a._v(" "),s("p",[a._v("提示：需要内核2.6.13以后内核版本才能支持inotify\n可以使用如下命名查看内核版本")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("uname")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-r")]),a._v("\n")])])]),s("h2",{attrs:{id:"安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[a._v("#")]),a._v(" 安装")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("yum "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" inotify-tools\n")])])]),s("h2",{attrs:{id:"inotifywait的使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#inotifywait的使用"}},[a._v("#")]),a._v(" inotifywait的使用")]),a._v(" "),s("p",[a._v("参数说明：")]),a._v(" "),s("ul",[s("li",[a._v("--exclude pattern 排除文件")]),a._v(" "),s("li",[a._v("--excludei pattern 排除文件，不区分大小写")]),a._v(" "),s("li",[a._v("-r --recursive 递归目录")]),a._v(" "),s("li",[a._v("-m --monitor 保持一直监听，而不是监听到有变动的文件就退出了")]),a._v(" "),s("li",[a._v("-e --event 要监听的事件，多个用(,)号隔开，默认全部\n"),s("ul",[s("li",[a._v("create")]),a._v(" "),s("li",[a._v("delete")]),a._v(" "),s("li",[a._v("modify")]),a._v(" "),s("li",[a._v("attrib")]),a._v(" "),s("li",[a._v("open")]),a._v(" "),s("li",[a._v("close")]),a._v(" "),s("li",[a._v("access")]),a._v(" "),s("li",[a._v("unmount")])])]),a._v(" "),s("li",[a._v("-q --quiet 结果精简")]),a._v(" "),s("li",[a._v("--format fmt 结果格式化\n"),s("ul",[s("li",[a._v("%w 表示发生事件的目录")]),a._v(" "),s("li",[a._v("%f 表示发生事件的文件")]),a._v(" "),s("li",[a._v("%e 表示发生的事件")]),a._v(" "),s("li",[a._v("%Xe 事件以“X”分隔")]),a._v(" "),s("li",[a._v("%T 使用由–timefmt定义的时间格式")])])]),a._v(" "),s("li",[a._v("--timefmt fmt 时间格式化")])]),a._v(" "),s("p",[a._v("实时监控文件变化")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("inotifywait "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-rmq")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"create,modify,delete,move,attrib"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--exclude")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"\\.(swp|swx)$"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--format")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"%w%f"')]),a._v(" /var/www/xxx\n")])])]),s("h2",{attrs:{id:"结合rsync实时远程同步脚本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#结合rsync实时远程同步脚本"}},[a._v("#")]),a._v(" 结合rsync实时远程同步脚本")]),a._v(" "),s("p",[a._v("注意：远程同步需要生成rsa公钥和私钥进行认证，避免输入密码。")]),a._v(" "),s("p",[a._v("vim /usr/local/scripts/file-sync.sh")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token shebang important"}},[a._v("#!/bin/bash")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("PATH_SRC")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/data/xxx/\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("PATH_DEST")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("root@192.168.1.217:/data/backups/xxx/\n\n/usr/bin/inotifywait "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-mrq")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"create,modify,attrib,move,delete"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--format")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"%f"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--exclude")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"\\.(swp|swx)$"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$PATH_SRC")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("while")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("read")]),a._v(" line\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("do")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#echo $line")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$line")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("then")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rsync")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-az")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$PATH_SRC")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$line")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$PATH_DEST")]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$line")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rsync")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-az")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--delete")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$PATH_SRC")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$PATH_DEST")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("fi")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("done")]),a._v("\n")])])]),s("p",[a._v("设置脚本自动在后台运行，并设置开机启动")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /usr/lib/systemd/system/file-sync.service "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("EOF\n[Unit]\nDescription=file-sync\nAfter=network.target\n\n[Service]\nUser=root\nGroup=root\nExecStart=/bin/bash /usr/local/scripts/file-sync.sh\nExecStop=\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\nEOF")]),a._v("\n\nsystemctl daemon-reload\nsystemctl start file-sync\nsystemctl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("enable")]),a._v(" file-sync\n")])])]),s("blockquote",[s("p",[a._v("🕑 最后更新时间: 2022-10-14 08:32")])])])}),[],!1,null,null,null);s.default=r.exports}}]);